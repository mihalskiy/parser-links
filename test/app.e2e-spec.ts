import { Test, TestingModule } from '@nestjs/testing';
import { INestApplication } from '@nestjs/common';
import * as request from 'supertest';
import { AppModule } from './../src/app.module';

describe('AppController (e2e)', () => {
  let app: INestApplication;

  beforeEach(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  it('parse links with correct file (GET)', () => {
    return request(app.getHttpServer())
      .get('/filename?')
      .expect(200)
      .expect([{"Host":"www.google-analytics.com","Count":24},{"Host":"clients1.google.com","Count":18},{"Host":"www.google.com","Count":16},{"Host":"69.59.144.138","Count":15},{"Host":"t0.gstatic.com","Count":15},{"Host":"t3.gstatic.com","Count":15},{"Host":"googleads.g.doubleclick.net","Count":13},{"Host":"wl.dlservice.microsoft.com","Count":12},{"Host":"t1.gstatic.com","Count":11},{"Host":"www.shukumaku.com","Count":10},{"Host":"www.3amir.com","Count":10},{"Host":"chat4.doook.com","Count":10},{"Host":"www.paltalk.com","Count":8},{"Host":"173.192.17.101","Count":8},{"Host":"t2.gstatic.com","Count":8},{"Host":"hjphoto.manjam.com","Count":7},{"Host":"safebrowsing-cache.google.com","Count":7},{"Host":"www.cartoonnetworkarabic.com","Count":7},{"Host":"syndication.exoclick.com","Count":7},{"Host":"clic-diffusion.com","Count":6},{"Host":"mw2.google.com","Count":6},{"Host":"www.alsayra.com","Count":6},{"Host":"porn648.xvideos.com","Count":6},{"Host":"static.4shared.com","Count":5},{"Host":"pixel.quantserve.com","Count":5},{"Host":"advertising.indexmultimedia.com","Count":5},{"Host":"www.facebook.com","Count":5},{"Host":"au.download.windowsupdate.com","Count":5},{"Host":"i4.ytimg.com","Count":5},{"Host":"beacon-1.newrelic.com","Count":4},{"Host":"ohmilfs.com","Count":4},{"Host":"khmdb.google.com","Count":4},{"Host":"content.foto.mail.ru","Count":4},{"Host":"208.71.130.51","Count":4},{"Host":"alerts.conduit-services.com","Count":4},{"Host":"kh.google.com","Count":3},{"Host":"www.p33p.com","Count":3},{"Host":"l.addthiscdn.com","Count":3},{"Host":"www.supervpn.net","Count":3},{"Host":"www.bing.com","Count":3},{"Host":"is.gd","Count":3},{"Host":"www.youjizz.com","Count":3},{"Host":"img.imgsmail.ru","Count":3},{"Host":"top.oopsmovs.com","Count":3},{"Host":"fs2.migahost.com","Count":3},{"Host":"feeds.bbci.co.uk","Count":3},{"Host":"tools.google.com","Count":3},{"Host":"img2.imgsmail.ru","Count":3},{"Host":"c2r.microsoft.com","Count":2},{"Host":"www.elebda3.net","Count":2},{"Host":"www9.0zz0.com","Count":2},{"Host":"n2vads.com","Count":2},{"Host":"syts2.travian.com","Count":2},{"Host":"gfx3.hotmail.com","Count":2},{"Host":"media.winamp.com","Count":2},{"Host":"counter.yadro.ru","Count":2},{"Host":"images.hi5.com","Count":2},{"Host":"asktoolbar.weather.com","Count":2},{"Host":"www.manjam.com","Count":2},{"Host":"www.vidivodo.com","Count":2},{"Host":"pubads.g.doubleclick.net","Count":2},{"Host":"porn977.xvideos.com","Count":2},{"Host":"mw1.google.com","Count":2},{"Host":"songs.6rby.com","Count":2},{"Host":"searchclient.live.net","Count":2},{"Host":"www.cell11.com","Count":2},{"Host":"ads.handycafe.com","Count":2},{"Host":"mt0.google.com","Count":2},{"Host":"osce10-icss-p.activeupdate.trendmicro.com","Count":2},{"Host":"suggestqueries.google.com","Count":2},{"Host":"s.ytimg.com","Count":2},{"Host":"porn031.xvideos.com","Count":2},{"Host":"tags2.trackinganalytics.com","Count":2},{"Host":"61.160.235.210","Count":2},{"Host":"personal.avira-update.com","Count":1},{"Host":"d2.50dd.net","Count":1},{"Host":"mswindowswolglobal.112.2o7.net","Count":1},{"Host":"weather.noaa.gov","Count":1},{"Host":"danlambaovn.blogspot.com","Count":1},{"Host":"content.pop6.com","Count":1},{"Host":"x115.iloveim.com","Count":1},{"Host":"0.164.channel.facebook.com","Count":1},{"Host":"www.youtube.com","Count":1},{"Host":"static.xvideos.com","Count":1},{"Host":"profile.live.com","Count":1},{"Host":"us.mg4.mail.yahoo.com","Count":1},{"Host":"www.elahmad.com","Count":1},{"Host":"a.collective-media.net","Count":1},{"Host":"websrv.youtradefx.com","Count":1},{"Host":"i2.ytimg.com","Count":1},{"Host":"inside-msn.spaces.live.com","Count":1},{"Host":"ftp.kaspersky.com","Count":1},{"Host":"s.youtube.com","Count":1},{"Host":"ib.adnxs.com","Count":1},{"Host":"edge.quantserve.com","Count":1},{"Host":"edge1.catalog.video.msn.com","Count":1},{"Host":"android.clients.google.com","Count":1},{"Host":"download138.mediafire.com","Count":1},{"Host":"pbid.iforex.com","Count":1},{"Host":"off1.picsrc.net","Count":1},{"Host":"cdn.api.twitter.com","Count":1},{"Host":"cot1.ostkcdn.com","Count":1},{"Host":"twitter.com","Count":1},{"Host":"chat.meebo.ec2.conduit.com","Count":1},{"Host":"www.hdfreeporno.com","Count":1},{"Host":"main.exoclick.com","Count":1},{"Host":"myegy.com","Count":1},{"Host":"92.122.49.164","Count":1},{"Host":"us.mg1.mail.yahoo.com","Count":1},{"Host":"forums.myegy.com","Count":1},{"Host":"www.svuonline.org","Count":1},{"Host":"www2.0zz0.com","Count":1},{"Host":"acemoglusucuklari.com.tr","Count":1},{"Host":"toolbar.live.com","Count":1},{"Host":"productnews.link.net","Count":1},{"Host":"s.xvideos.com","Count":1},{"Host":"ox-d.knockbook.me","Count":1},{"Host":"static.ak.facebook.com","Count":1},{"Host":"www3.0zz0.com","Count":1},{"Host":"www.manalonline.com","Count":1},{"Host":"toolbarqueries.clients.google.com","Count":1},{"Host":"img4.catalog.video.msn.com","Count":1},{"Host":"infoservice.inf.tu-dresden.de","Count":1},{"Host":"gate.ahram.org.eg","Count":1},{"Host":"pro.weborama.fr","Count":1},{"Host":"client-software.real.com","Count":1},{"Host":"tt.mimagoo.com","Count":1},{"Host":"www.123peppy.com","Count":1},{"Host":"finance.yahoo.com","Count":1},{"Host":"lads.myspacecdn.com","Count":1},{"Host":"www.leballonrond.fr","Count":1},{"Host":"rp.gwallet.com","Count":1},{"Host":"themafia.ae","Count":1},{"Host":"www.migbank.com","Count":1},{"Host":"safebrowsing.clients.google.com","Count":1},{"Host":"ad.yieldmanager.com","Count":1},{"Host":"www.msftncsi.com","Count":1},{"Host":"download.getjar.com","Count":1},{"Host":"cid-fe8b1ed3ba1ac439.profile.live.com","Count":1},{"Host":"news.bbcimg.co.uk","Count":1},{"Host":"i3.ytimg.com","Count":1},{"Host":"delb.opt.fimserve.com","Count":1},{"Host":"www.jo1jo.com","Count":1},{"Host":"drp.su","Count":1},{"Host":"photos2.hi5.com","Count":1},{"Host":"playerstatics1.poker.static.zynga.com","Count":1},{"Host":"d7.zedo.com","Count":1},{"Host":"zamalekfans.com","Count":1},{"Host":"obraz.foto.mail.ru","Count":1},{"Host":"www.syria4our.com","Count":1},{"Host":"d3.50dd.net","Count":1},{"Host":"x68.iloveim.com","Count":1},{"Host":"gdata.youtube.com","Count":1},{"Host":"v16.lscache3.googlevideo.com","Count":1},{"Host":"www.samsung.com","Count":1},{"Host":"www.4shared.com","Count":1},{"Host":"www.nobles-news.com","Count":1},{"Host":"download818.avast.com","Count":1},{"Host":"pagead2.googlesyndication.com","Count":1},{"Host":"download387.mediafire.com","Count":1},{"Host":"s4.histats.com","Count":1},{"Host":"content.prod.uscrybe.com","Count":1},{"Host":"feeds2.feedburner.com","Count":1},{"Host":"www.hairy-beauty.com","Count":1},{"Host":"t6.oopsmovs.com","Count":1}]);
  });

  it('if not found file (GET)', () => {
    return request(app.getHttpServer())
      .get('/filename?filePath=wfr')
      .expect(404)
      .expect({"statusCode":404,"message":"ENOENT: no such file or directory, open 'wfr'"})
  });
});
